task(packForXcode, type: Sync) {
    group = 'build'
    def mode = System.getenv('CONFIGURATION') ?: 'DEBUG'
    def sdkName = System.getenv("SDK_NAME") ?: "iphonesimulator"
    def targetName = "ios" + ((sdkName.startsWith("iphoneos")) ? "Arm64" : "X64")
    def framework = kotlin.targets.getByName(targetName).binaries.getFramework(mode)
    inputs.property('mode', mode)
    dependsOn(framework.linkTask)
    def targetDir = new File(buildDir, 'xcode-frameworks')
    from({ framework.outputDirectory })
    into(targetDir)
}
